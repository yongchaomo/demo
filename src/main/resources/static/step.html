<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id"
          content="850028403875-fu79qusp020ht0idsootgov81dh88957.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <title> DYN ICO rgb(255, 127, 7)</title>
    <link rel="shortcut icon" type="image/x-icon" href="src/image/dyn-logo.ico">
    <script src="src/js/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="src/css/bootstrap.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_704001_8vcklvuj0xf.css">
    <!-- <script src="src/js/spryMap-min2.js"></script> -->
    <script type="module" src='https://www.google.com/recaptcha/api.js?hl=en'></script>
    <script type="text/javascript">
        var verifyCallback = function (response) {
            $.ajax({
                url: 'https://www.google.com/recaptcha/api/siteverify',
                data: {
                    secret: '6LdmAmYUAAAAAGCv2DKKtL-Yv38WMEVmUS1V-VDU',
                    response: response
                },
                contentType: "application/json;charset=UTF-8",
                dataType: 'json',
                crossDomain: true,
                type: 'post',
                success: function (data) {
                    alert(JSON.stringify(data));
                }
            });
        };
        var widgetId1;
        var onloadCallback = function () {
            // Renders the HTML element with id 'example1' as a reCAPTCHA widget.
            // The id of the reCAPTCHA widget is assigned to 'widgetId1'.
            grecaptcha.render('example1', {
                'sitekey': '6LdmAmYUAAAAAOYRkS56zd2Mvn3IzPMXDG0Xs1lM',
                'callback': verifyCallback,
                'theme': 'light'
            });
        };
    </script>
    <link rel="stylesheet" media="screen" href="src/step/css/zzsc.css"/>
    <style>
        .btn-social#facebook_login {
            background: #D94E36;
        }

        .btn-social:not(:first-child) {
            margin-top: 5px;
        }

        .btn-block + .btn-block {
            margin-top: 10px;
        }

        .btn-block + .btn-block {
            margin-top: 5px;
        }

        .btn-social {
            color: #fff;
            text-align: left;
            margin-top: 5px;
        }

        [class^="icon-"], [class*=" icon-"] {
            font-family: 'icomoon';
            speak: none;
            font-style: normal;
            font-weight: normal;
            font-variant: normal;
            text-transform: none;
            line-height: 1;
            min-width: 1em;
            display: inline-block;
            text-align: center;
            font-size: 16px;
            vertical-align: middle;
            position: relative;
            top: -1px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .btn-social#google_login {
            background: #2C60B2;
        }

        .btn-social:not(:first-child) {
            margin-top: 5px;
        }

        .hidden-box .btn {
            color: white;
            font-weight: normal;
        }
    </style>
    <style>
        .ipt-wrap {
            width: 100%;
            margin-bottom: 3%;
        }

        .rightBtn {
            width: 20%;
            position: absolute;
            right: 0;
            top: 0;
            transition: background-color 0.5s ease;
        }

        fieldset .superiorDiv {
            margin: 3% auto;
            overflow: hidden;
        }

        .ipt-wrap-right {
            overflow: hidden;
        }

        .ipt-wrap-right input {
            margin-bottom: 2%;
        }

        .ipt-wrap-left-btn {
            width: 45%;
            float: left;
        }

        .ipt-wrap-right-btn {
            width: 50%;
            float: right;
        }

        .fs-subtitle-top {
            margin-bottom: 10px;
        }

        .fs-subtitle-a {
            background-color: lightgray;
        }

        .container-template h3 p {
            margin: 15px;
            color: white;
        }


    </style>
    <style>
        @media (max-width: 800px) {
            #msform {
                width: auto;
            }

            #msform fieldset {
                padding: 20px 13px;
                width: 95%;
                margin: 0 2.5%;
            }

            li {
                letter-spacing: 2px;
            }

            .container-template h3 p {
                font-size: 18px;
            }

            .fs-subtitle-span span {
                font-size: 10px;
                padding: 0px 2px;
            }
        }

        @media (min-width: 800px) {

        }
    </style>
</head>
<div id="msform">
    <div class="content">
        <div class="container-template">
            <h3>
                <a href="javascript:void(0);">
                    <img src="src/image/logo.png" alt="DYN" height="50">
                </a>
                <p>DYN</p>
                <p>The World’s First Instant Crypto-backed Loans</p>
            </h3>
        </div>
    </div>

    <!-- progressbar -->
    <ul id="progressbar">
        <li class="active">Basic Information</li>
        <li>Social Profiles</li>
        <li>Personal Details</li>
    </ul>
    <!-- fieldsets -->
    <fieldset>
        <div class="superiorDiv">
            <h2 class="fs-title">Create your account</h2>
            <h3 class="fs-subtitle">Private mailbox</h3>
            <div class="ipt-wrap">
                <div class="ipt-wrap-left">
                    <h5 style="color: brown;display: none"></h5>
                    <form style="position: relative;">
                        <input type="email" class="form-control" placeholder="Your Email"/>
                        <input type="button" id="judgmentBtn" class="form-control rightBtn" value="code"/></form>
                </div>
                <div class="ipt-wrap-right" style="display: none;">
                    <form id="ipt-wrap-right-form">
                        <h5 style="color: brown;display: none"></h5>
                        <h5 style="color: brown;display: none"></h5>
                        <input type="text" class="form-control" readonly="readonly" style="border: none;" name="email"/>
                        <input type="text" class="form-control" placeholder="Verification code:" name="code"/>
                        <input type="text" class="form-control" placeholder="Bitcoin address:" name="purseAddress"/>
                        <input type="password" class="form-control" placeholder="password:" name="password"/>
                        <input type="button" class="form-control ipt-wrap-left-btn" value="back"/>
                        <input type="button" class="form-control ipt-wrap-right-btn" value="Submit"/>
                    </form>
                </div>
            </div>
            <div class="ipt-wrap-beneath">
                <h3 class="fs-subtitle">Use a third party</h3>
                <button id="facebook_login" class="btn btn-block btn-social">
                    <i class="iconfont icon-facebook"></i>
                    Sign
                    in
                    with Facebook
                </button>
                <button id="google_login" class="btn btn-block btn-social" data-gapiattached="true">
                    <i class="iconfont icon-google"></i>
                    Sign
                    in
                    with Google+
                </button>
            </div>
        </div>
        <div class="superiorDiv" style="text-align: left;display: none">
            <h2 class="fs-title">Your rights</h2>
            <h3 class="fs-subtitle fs-subtitle-top">Share this link and get 10% of payments of your referrals:</h3>
            <h3 class="fs-subtitle fs-subtitle-span" style="position: relative;">
                <span class="form-control"></span>
                <input type="button" id="judgmentBtn" class="form-control rightBtn" value="code"/>
            </h3>
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
            <div id="addthis_inline_share_toolbox" class="addthis_inline_share_toolbox"
                 data-title="赶紧来购买DYN吧" data-url=""></div>
            <h3 class="fs-subtitle fs-subtitle-top">Click on the link below to purchase DYN now:</h3>
            <h3 class="fs-subtitle fs-subtitle-a">
                <a class="btn">Jump</a>
            </h3>
            <h3 class="fs-subtitle fs-subtitle-top">Special account management interface:</h3>
            <h3 class="fs-subtitle fs-subtitle-a">
                <a class="btn">Jump</a>
            </h3>
            <h2 class="fs-title">Improve your profile and get more extra tokens...</h2>
        </div>
        <input type="button" name="next" class="next action-button" value="Next" style="display: none;"/>
    </fieldset>
    <fieldset>
        <h2 class="fs-title">Social Profiles</h2>
        <h3 class="fs-subtitle">Your presence on the social network</h3>
        <input type="text" name="twitter" placeholder="Twitter"/>
        <input type="text" name="facebook" placeholder="Facebook"/>
        <input type="text" name="gplus" placeholder="Google Plus"/>
        <input type="button" name="previous" class="previous action-button" value="Previous"/>
        <input type="button" name="next" class="next action-button" value="Next"/>
    </fieldset>
    <fieldset>
        <h2 class="fs-title">Personal Details</h2>
        <h3 class="fs-subtitle">We will never sell it</h3>
        <input type="text" name="fname" placeholder="First Name"/>
        <input type="text" name="lname" placeholder="Last Name"/>
        <input type="text" name="phone" placeholder="Phone"/>
        <textarea name="address" placeholder="Address"></textarea>
        <input type="button" name="previous" class="previous action-button" value="Previous"/>
        <input type="submit" name="submit" class="submit action-button" value="Submit"/>
    </fieldset>
</div>
<script src="http://thecodeplayer.com/uploads/js/jquery.easing.min.js" type="text/javascript"></script>
<script src="src/step/js/zzsc.js" type="text/javascript"></script>

<script>
    var pswRule = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,21}$/;
    var emailRule = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
    //初始化facebook登录
    window.fbAsyncInit = function () {
        FB.init({
            appId: '614590935590533',
            cookie: true,  // enable cookies to allow the server to access the session
            xfbml: true,  // parse social plugins on this page
            version: 'v3.0' // use graph api version 2.8
        });
    };
    //引入第三方登录js
    (function (d, s, facebookid, googleid) {
        var js, po, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(facebookid)) return;
        js = d.createElement(s);
        js.id = facebookid;
        js.type = 'text/javascript';
        js.async = true;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);

        if (d.getElementById(googleid)) return;
        po = d.createElement(s);
        po.id = googleid;
        po.type = 'text/javascript';
        po.async = true;
        po.src = 'https://apis.google.com/js/client:plusone.js?onload=render'; // 后边加onload触发初始化函数
        fjs.parentNode.insertBefore(po, fjs);
    }(document, 'script', 'facebook-jssdk', 'google-jssdk'));

    //谷歌初始化
    function render() {
        gapi.signin.render('google_login', {
            'callback': 'signinCallback',
            'approvalprompt': 'force',
            // 这里写入你的App ID
            'clientid': '850028403875-fu79qusp020ht0idsootgov81dh88957.apps.googleusercontent.com',
            'cookiepolicy': 'single_host_origin',
            'requestvisibleactions': 'http://schemas.google.com/AddActivity',
            'scope': 'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email'
        });
    }

    var userAuths = new Object();
    var auths = new Object();
    //facebook登录
    $("#facebook_login").click(function () {
        FB.login(function (response) {
            if (response.status === 'connected') {
                FB.api('/me?fields=id, first_name, last_name, email', function (response) {
                    if (!response.email != undefined) {
                        userAuths.firstName = response.first_name;
                        userAuths.lastName = response.last_name;
                        auths.identityType = "facebook";
                        auths.credential = response.id;
                        auths.identifier = response.email;
                        getSendEmail(response.email, 1);
                    } else {
                        $(".ipt-wrap-left h5").css("color", "brown").html("Mailbox verification failed").show();
                    }
                });
            } else if (response.status === 'not_authorized') {
                $(".ipt-wrap-left h5").css("color", "brown").html("unauthorized").show();
            } else {
                $(".ipt-wrap-left h5").css("color", "brown").html("Login failed").show();
            }
        }, {scope: 'email'});
    });
</script>
<script>
    $("#judgmentBtn").click(function () {
        var email = $(".ipt-wrap-left input[type='email']").val();
        if (email == null || email == undefined || email == "") {
            $(".ipt-wrap-left h5").css("color", "brown").html("Mailbox cannot be empty").show();
        } else {
            if (emailRule.test(email)) {
                getSendEmail(email, 0);
            } else {
                $(".ipt-wrap-left h5").css("color", "brown").html("E-mail format is incorrect").show();
            }
        }
    });

    $(".ipt-wrap-left-btn").click(function () {
        $(".ipt-wrap-right").hide();
        $(".ipt-wrap-left").show();
        $(".ipt-wrap-beneath").show();
    });

    $(".ipt-wrap-right-btn").click(function () {
        var formData = $("#ipt-wrap-right-form").serializeArray();
        var user = new Object();
        var falg = true;
        $("#ipt-wrap-right-form h5").eq(0).hide();
        $("#ipt-wrap-right-form h5").eq(1).hide();
        $("#ipt-wrap-right-form input").css("border", "1px solid #ccc");
        $.each(formData, function (index, data) {
            if (data.value == null || data.value == undefined || data.value == "") {
                $("#ipt-wrap-right-form input[name='" + data.name + "']").css("border", "1px solid brown");
                falg = false;
            }
            if (data.name == "email") {
                user.email = data.value;
            }
            if (data.name == "code") {
                user.code = data.value;
            }
            if (data.name == "purseAddress") {
                user.purseAddress = data.value;
            }
            if (data.name == "password") {
                if (pswRule.test(data.value)) {
                    user.password = data.value;
                    $("#ipt-wrap-right-form h5").eq(1).hide();
                } else {
                    falg = false;
                    $("#ipt-wrap-right-form input[name='" + data.name + "']").css("border", "1px solid brown");
                    $("#ipt-wrap-right-form h5").eq(1).html("Contains 6 to 21 digits, uppercase and lowercase letters").show();

                }
            }
        });
        if (falg == true) {
            if (formData.length == 2) {
                userAuths.purseAddress = user.purseAddress;
                getRegisterUser();
            } else {
                getRegisterUser(user);
            }
        } else {
            $("#ipt-wrap-right-form h5").eq(0).html("Please enter the correct information").show();
        }
    });

    function getSendEmail(email, type) {
        $.ajax({
            url: 'sendEmail',
            data: {
                email: email,
                type: 3
            },
            dataType: 'json',
            type: 'get',
            success: function (data) {
                if (data.data.msg == "该用户未注册") {
                    console.log('用户未存在');
                    $.ajax({
                        url: 'sendEmail',
                        data: {
                            email: email,
                            type: 2
                        },
                        dataType: 'json',
                        type: 'get',
                        success: function (data) {
                            if (type == 0) {
                                $(".ipt-wrap-left").hide();
                                $(".ipt-wrap-left h5").css("color", "").hide();
                                $(".ipt-wrap-beneath").hide();
                                $(".ipt-wrap-right input[name='code']").attr("disabled", false).show();
                                $(".ipt-wrap-right input[name='password']").attr("disabled", false).show();
                                $(".ipt-wrap-right").show();
                                $(".ipt-wrap-right input[type='text']").val("");
                                $(".ipt-wrap-right input[readonly='readonly']").val(email);
                            } else {
                                $(".ipt-wrap-left").hide();
                                $(".ipt-wrap-left h5").css("color", "").hide();
                                $(".ipt-wrap-beneath").hide();
                                $(".ipt-wrap-right input[name='code']").attr("disabled", true).hide();
                                $(".ipt-wrap-right input[name='password']").attr("disabled", true).hide();
                                $(".ipt-wrap-right").show();
                                $(".ipt-wrap-right input[type='text']").val("");
                                $(".ipt-wrap-right input[readonly='readonly']").val(email);
                            }
                        }
                    });
                } else {
                    $(".ipt-wrap-left h5").css("color", "brown").html(data.data.msg).show();
                }
            }
        });
    }

    function getRegisterUser(user) {
        if (user == null) {
            user = JSON.stringify(userAuths);
            auths = JSON.stringify(auths);
        } else {
            user = JSON.stringify(user);
            auths = null;
        }
        $.ajax({
            url: 'register',
            data: {
                'user': user,
                'auths': auths
            },
            dataType: 'json',
            type: 'post',
            success: function (data) {
                if (data.data.msg != null) {
                    $(".superiorDiv").eq(0).hide();
                    $(".fs-subtitle-span span").html("https://www.dynamic-yc.cn/?referral=" + data.data.msg.sharingToken);
                    $("fieldset").eq(0).children("input").show();
                    $(".superiorDiv").eq(1).show();
                } else {
                    $("#ipt-wrap-right-form h5").eq(0).html("verification failed").show();
                }
            }
        });
        auths = new Object();
        userAuths = new Object();
    }

</script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<!--<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b4d516aa080163c"></script>-->
</body>
</html>